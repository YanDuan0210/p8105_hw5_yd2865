---
title: "p8105_hw5_yd2865"
author: "Yan Duan"
date: "2025-11-11"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(broom)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

I'm an R Markdown document! 

## Problem 1

```{r}
# checks whether there are duplicate birthdays in the group.
dup_birth = function(n, days = 365) {
  
  birth = sample(1:days, n, replace = TRUE) 
  
  length(unique(birth)) < length(birth) 
}
```

```{r}
# simulate 10000 times and calculate the probability.
set.seed(123)
sim_results_df = 
  tibble(n = 2:50) |>
 mutate(
    prob = map_dbl(n,
      ~ mean(replicate(10000, dup_birth(.x))) 
  ))

sim_results_df
```


#### Make a plot

```{r}
sim_results_df |>
  ggplot(aes(x = n, y = prob)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Birthday Problem Simulation (10,000 runs per n)",
    x = "Group size n",
    y = "Pr(at least two share a birthday)"
  ) 
```

**Comments**: As the number of group members increases, the probability that at least two people in the group have the same birthday gradually rises. When the group size is small (for example, less than 10 people), the probability is very low and it is almost impossible for the same birthday to occur. However, as the number continues to increase, this probability grows very rapidly. When the number reaches around 23 people, the probability is already close to 0.5, meaning that the chance of having the same birthday has reached half. By around 50 people, the probability is almost close to 1, which means that it is almost certain that there will be two people with the same birthday. This indicates that a relatively small group can achieve an extremely high probability of having overlapping birthdays.


## Problem 2

```{r}
simulate_t_tests = function(mu, n = 30, sigma = 5, n_sim = 5000) {
  
  map_dfr(1:n_sim, function(i) {
    
    x = rnorm(n, mean = mu, sd = sigma)
    est = mean(x)
    se = sd(x) / sqrt(n)
    t = est / se
    p = 2 * pt(abs(t), df = n - 1, lower.tail = FALSE)
    tibble(mu_true = mu, sim = i, estimate = est, p.value = p, reject = p < 0.05)
    
  })
}
```


```{r}
set.seed(123)
mus = 0:6
results_list = lapply(mus, simulate_t_tests)
sim_results = bind_rows(results_list)

# The power of the test vs. true mean
summary_df =
  sim_results %>%
  group_by(mu_true) %>%
  summarise(
    power = mean(reject),                
    avg_mu_hat_all = mean(estimate),             
    avg_mu_hat_rej = mean(estimate[reject]),   
    .groups = "drop"
  )

summary_df
```

#### Make a plot(Power vs mu_true)

```{r}
# Plot1
summary_df |> 
  ggplot(aes(x = mu_true, y = power)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = mus) +
  labs(
    title = "One-sample t-test Power (n = 30, sigma = 5, alpha = 0.05)",
    x = "True mean Î¼",
    y = "Power"
  )
```

